# JPA 상속관계 매핑 간단정리

jpa에서 제공하는 상소관계 매핑에 관련된 기능에 대해서 간단히 서술

참고정보
-
- RDBMS는 상속관계가 없다.
- JPA에서는 데이터베이스의 슈퍼타입 서브타입 관계 매핑을 객체의 상속 구조에 적용한다.

 
상속관계 매핑 종류 3가지
-
<h3>1. 조인전략</h3>
<h3>2. 단일 테이블 전략</h3>
<h3>3. 구현 클래스마다 각 각의 테이블 생성전략 </h3>

조인전략
-
상속받는 입장의 테이블과 상속하는 테이블을 조인해서 정보를 가져온다.

<img src="https://user-images.githubusercontent.com/62128211/128265527-ff094152-f67d-4d82-9dfe-0c70dc816695.png" width=700 height=300 >

해당 그림은 이해를 위한 예시의 논리적 모델을 나타낸 것이다.

Item의 속성을 공통요소로 상속받고 Album, Movie, Book은 각 각 고유의 속성들을 가지고 있다.

논리적 모델을 기반으로 JPA를 사용하여 조인전략이 적용하기 위해서는 item class에
@Inheritance(strategy=InheritanceType.XXX) 어노테이션을 추가해주면 된다.
조인 전략 이므로 XXX에 JOINED를 대치해주면 된다.

또한 조인 전략을 사용할 경우 DTYPE 속성이 테이블에 자동 추가된다. 해당 속성은 어떠한 테이블이 Item을 상속받아 구현되었는지 알려준다.
@DiscriminatorColumn(name=“DTYPE”)
name을 따로 지정하지 않는다면 테이블의 이름이 자동으로 지정된다.

<img src="https://user-images.githubusercontent.com/62128211/128266825-aa8add6d-91e0-444f-840c-c0dc543d8743.png">

해당 그림은 논리적 모델을 기반으로 생성된 물리적 모델을 나타낸 것이다. 정보 조회 시 조인을 사용한다.

조인 전략의 장점
- 테이블 정규화가 가능
- 저장공간 효율화

조인 전략의 단점
- 조회시 조인을 많이 사용하기 때문에 성능 저하가 동반된다.
-  조회 쿼리가 복잡하다.
-  데이터 저장 시 두 개의 테이블에 나눠 저장되기 때문에 insert가 두 번 발생한다.

단일 테이블 전략
-
논리적 모델의 모든 테이블의 속성을 한 테이블에 넣어버린다.

<img src = "https://user-images.githubusercontent.com/62128211/128268341-23657091-3529-43d6-8b6b-190b795e09fe.png" width=700 height=300 >

해당 그림은 논리적 모델을 기반으로 단일 테이블 전략을 사용하여 물리 테이블을 구성한 것이다.

간단한 테이블과 연관관계로 구성되어 있을 경우 사용하면 효과적이다. 모든 속성들이 한 테이블에 들어있기 때문에 관리가 매우 편리하다.

해당 전략 또한
@Inheritance(strategy=InheritanceType.XXX)
@DiscriminatorColumn(name=“DTYPE”)
를 사용하여 구현이 가능하다.

단일 테이블 전략의 장점
- 조인이 필요 없기 때문에 성능이 좋다.
- 조회 쿼리가 단순하다.

단일 테이블 전략의 단점
- 사용하지 않는 속성들이 존재하기 때문에 자식 엔티티에 매핑된 컬럼은 모두 null을 허용해야한다.
- 한 테이블에 모든 정보가 들어가기 때문에 한 개 테이블 용량이 엄청나게 커질 수 있다. 하지만 단일 테이블 전략이 사용되는 경우를 고려하면 큰 문제가 되는 경우는 거의 없다.

구현 클래스 마다 각 각의 테이블 생성 전략
-

<img src="https://user-images.githubusercontent.com/62128211/128268806-f8815b45-6a33-4c5f-beda-852ad91b80d3.png" width=700 height=300>

위의 그림은 논리적 모델을 기반으로 구현 클래스 마다 각 각의 테이블 생성 전략에 따른 물리적 모델을 나타낸 것이다.

해당 방식은 상속받는 클래스 없이 그냥 각 각의 개별 테이블을 구성하여 따로 관리하는 방식이다. 따라서 여러 테이블을 함께 조회하기 위해서 UNION 연산이 사용되는데 이것은 성능에 치명적인 저하를 불러일으킨다. 따라서 사용을 지양하는 것이 좋다.

구현 클래스 마다 각 각의 테이블 생성 전략의 장점
- 서브 타입을 확실하게 구분하는데 효과적이다.
- not null의 조건도 허용가능하다.

구현 클래스 마다 각 각의 테이블 생성 전략의 단점
- 여러 서브 테이블을 함께 조회할 때 성능이 느리다.
- 서브 테이블을 통합하여 조회하는데 어렵다. 쿼리하기가 어렵기 때문이다.  


출처
-


해당 게시물의 내용은 모두 김영한님의 자바 ORM 표준 JPA 프로그래밍 - 기본편(인프런 제공)을 기반으로 작성되었습니다.


